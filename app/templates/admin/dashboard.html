{% extends 'layouts/base-fullscreen.html' %}

{% block title %}Dashboard Admin{% endblock %}

{% block content %}
<style>
  .text-primary {
    color: #6bade3 !important;
  }

  .table-custom thead {
    background-color: #1c5f96;
    color: white;
  }

  .badge-ringan {
    background-color: #6bade3;
    color: white;
  }

  .badge-sedang {
    background-color: #ffc107;
    color: #fcfcfc;
  }

  .badge-berat {
    background-color: #dc3545;
    color: white;
  }
  .pagination .page-link {
    color: #6bade3;
    border: 1px solid #6bade3;
  }

  .pagination .page-item.active .page-link {
    background-color: #6bade3;
    border-color: #6bade3;
    color: #fff;
  }

  .pagination .page-item.disabled .page-link {
    color: #ccc;
    border-color: #ccc;
  }

  .pagination .page-link:hover {
    background-color: #6bade3;
    color: white;
  }
</style>

<div class ="container mt-7">

<h3 class="text-center text-primary mb-4">Data Record</h3>

<div class="table-responsive">
    <table class="table table-bordered table-striped align-middle text-center table-custom">
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
              {% if pagination.has_prev %}
              <li class="page-item">
                <a class="page-link" href="{{ url_for('admin.dashboard', page=pagination.prev_num) }}" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
              {% else %}
              <li class="page-item disabled">
                <span class="page-link">&laquo;</span>
              </li>
              {% endif %}
          
              {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                {% if page_num %}
                  {% if page_num == pagination.page %}
                    <li class="page-item active"><span class="page-link">{{ page_num }}</span></li>
                  {% else %}
                    <li class="page-item"><a class="page-link" href="{{ url_for('admin.dashboard', page=page_num) }}">{{ page_num }}</a></li>
                  {% endif %}
                {% else %}
                  <li class="page-item disabled"><span class="page-link">â€¦</span></li>
                {% endif %}
              {% endfor %}
          
              {% if pagination.has_next %}
              <li class="page-item">
                <a class="page-link" href="{{ url_for('admin.dashboard', page=pagination.next_num) }}" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
              {% else %}
              <li class="page-item disabled">
                <span class="page-link">&raquo;</span>
              </li>
              {% endif %}
            </ul>
          </nav>
          
        <thead>
            <tr>
                <th>Nama</th>
                <th>Umur</th>
                <th>Usia Kehamilan</th>
                <th>Anak Keberapa</th>
                <th>Tanggal</th>
                <th>Hasil Diagnosa</th>
                <th>Skala</th>
            </tr>
        </thead>
        <tbody>
            {% if diagnosa_list %}
                {% for d in diagnosa_list %}
                <tr>
                    <td>
                        <a href="{{ url_for('admin.detail_diagnosa', id=d.id) }}" class="text-decoration-none text-primary">
                          {{ d.nama }}
                        </a>
                      </td>
                    <td>{{ d.umur }}</td>
                    <td>{{ d.usia_kehamilan }}</td>
                    <td>{{ d.anak_ke }}</td>
                    <td>{{ d.tanggal.strftime('%d-%m-%Y %H:%M:%S') }}</td>
                    <td>{{ d.penyakit.nama }}</td>
                    <td>
                        <span class="badge
                            {% if d.kelas == 'Berat' %}
                                badge-berat
                            {% elif d.kelas == 'Sedang' %}
                                badge-sedang
                            {% else %}
                                badge-ringan
                            {% endif %}
                        ">
                            {{ d.kelas }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="7" class="text-muted">Tidak ada data diagnosa.</td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>
</div>

<div class="container mt-7">
  <h3 class="text-center text-primary mb-4">Data Grafik</h3>

  <!-- Grafik Penyakit -->
  <div class="text-center mb-4">
    <canvas id="penyakitChart" width="400" height="200"></canvas>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle text-center table-custom">
      <!-- Tabel dan pagination kode disini -->
    </table>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Data penyakit dari server (dapat di-passing ke template Flask)
  var penyakitData = {
    P01: {{ penyakit_P01_count or 0 }},
    P02: {{ penyakit_P02_count or 0 }},
    P03: {{ penyakit_P03_count or 0 }}
  };

  // Cek data penyakit
  console.log(penyakitData);

  // Buat grafik dengan Chart.js
  var ctx = document.getElementById('penyakitChart').getContext('2d');
  var labels = [  'Depressi (' + penyakitData.P01 + ')', 
  'Stress (' + penyakitData.P02 + ')', 
  'Kecemasan (' + penyakitData.P03 + ')'];
  
  var penyakitChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,  // Label dinamis berdasarkan penyakit
      datasets: [
        {
          data: [penyakitData.P01, penyakitData.P02, penyakitData.P03],  // Data jumlah pengidap penyakit
          backgroundColor: ['#007bff', '#28a745', '#dc3545'],  // Warna grafik
          borderColor: ['#0056b3', '#218838', '#c82333'],  // Warna border
          borderWidth: 1
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          max: Math.max(penyakitData.P01, penyakitData.P02, penyakitData.P03) + 10 // Menyesuaikan skala maksimal
        }
      }
    }
  });
</script>




{% endblock %}
